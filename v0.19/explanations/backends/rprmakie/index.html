<!DOCTYPE html><HTML lang="en"><head><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="../../../libs/highlight/github.min.css" rel="stylesheet"/><link href="../../../css/franklin.css" rel="stylesheet"/><link href="../../../css/minimal-mistakes.css" rel="stylesheet"/><link href="../../../css/makie.css" rel="stylesheet"/><link href="../../../assets/icon_transparent.png" rel="icon"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://files.stork-search.net/releases/v1.4.2/basic.css" rel="stylesheet"/><style>
    .stork-wrapper {
      width:99%
    }
    .stork-wrapper .stork-results {
      max-height: 42vh;
    }
</style><title>RPRMakie Â· Makie</title></head><body class="layout--single"><div class="site-container"><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav class="greedy-nav" id="site-nav"><a class="title-icon" href="../../.."><img src="../../../assets/makie_logo_transparent.svg"/></a><ul class="visible-links"><li class="masthead__menu-item"><a href="https://github.com/JuliaPlots/Makie.jl"><img class="masthead-icon" src="../../../assets/GitHub-Mark-64px.png"/></a></li><li class="masthead__menu-item"><a href="../../../reference/">Reference</a></li><li class="masthead__menu-item"><a href="../../../tutorials/">Tutorials</a></li><li class="masthead__menu-item"><a href="../../../how-to/">How-Tos</a></li><li class="masthead__menu-item"><a href="../..">Explanations</a></li><li class="masthead__menu-item"><a href="../../../api/">API</a></li><li class="masthead__menu-item"><a href="../../../news/">News</a></li><li class="masthead__menu-item" id="masthead-search-button"><script>
                            function toggleSearchOverlay(){
                                const overlay = document.querySelector("#makiesearch-overlay-container");
                                overlay.classList.toggle("hidden");
                                overlay.querySelector("input").focus();
                                overlay.onclick = function(e){
                                    if (e.target !== this){
                                        return
                                    }
                                    this.classList.toggle("hidden");
                                };
                            }
                        </script><button onclick="toggleSearchOverlay()"><i class="fas fa-search"></i> Search</button></li></ul><button class="greedy-nav__toggle" type="button"><span class="visually-hidden">Toggle menu</span><div class="navicon"></div></button><ul class="hidden-links hidden"></ul></nav></div></div></div><div id="main" role="main"><div id="overlay"></div><div class="hidden" id="makiesearch-overlay-container"><div id="makiesearch-overlay-container-inner"><div id="makiesearch-overlay"></div></div></div><div class="content-table-hidden" id="content-table-container"><button id="on-this-page" onclick="toggle_content_table_visibility()">On this page</button><script>
            function toggle_content_table_visibility(){
              const c = document.querySelector("#content-table-container");
              const ct = c.querySelector("#content-table");
              const vh = window.visualViewport.height;
              ct.style.height = `${Math.min(ct.scrollHeight, 0.66*vh)}px`;
              c.classList.toggle("content-table-hidden");
            }
          </script><div id="content-table"><ul class="page-content"><li><a href="#activation_and_screen_config">Activation and screen config</a></li><li><a href="#materialx_and_predefined_materials_materialsjl">MaterialX and predefined materials (materials.jl)</a></li><li><a href="#advanced_custom_material_earth_topographyjl">Advanced custom material (earth_topography.jl)</a></li><li><a href="#rprmakie_interop_opengl_interopjl">RPRMakie interop (opengl_interop.jl)</a></li><li><a href="#animations_legojl">Animations (lego.jl)</a></li><li><a href="#earth_example">Earth example</a></li></ul></div></div><div id="navbar-container"><div id="navbar"><div id="makiesearch"></div><ul><li><div class="tocitem-container"><a href="../../..">Home</a></div></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-2"><i class="docs-chevron"></i></label><a href="../../../reference">Reference</a></div><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-2-1"><i class="docs-chevron"></i></label><a href="../../../reference/blocks">Blocks</a></div><ul><li><div class="tocitem-container"><a href="../../../reference/blocks/axis">Axis</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/axis3">Axis3</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/box">Box</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/button">Button</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/colorbar">Colorbar</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/gridlayout">GridLayout</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/intervalslider">IntervalSlider</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/label">Label</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/legend">Legend</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/lscene">LScene</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/menu">Menu</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/polaraxis">PolarAxis</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/slider">Slider</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/slidergrid">SliderGrid</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/textbox">Textbox</a></div></li><li><div class="tocitem-container"><a href="../../../reference/blocks/toggle">Toggle</a></div></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-2-2"><i class="docs-chevron"></i></label><a href="../../../reference/plots">Plots</a></div><ul><li><div class="tocitem-container"><a href="../../../reference/plots/ablines">ablines</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/arc">arc</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/arrows">arrows</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/band">band</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/barplot">barplot</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/boxplot">boxplot</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/bracket">bracket</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/contour">contour</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/contour3d">contour3d</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/contourf">contourf</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/crossbar">crossbar</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/datashader">datashader</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/density">density</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/ecdf">ecdfplot</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/errorbars">errorbars</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/heatmap">heatmap</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/hexbin">hexbin</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/hist">hist</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/hvlines">hlines and vlines</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/hvspan">hspan and vspan</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/image">image</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/lines">lines</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/linesegments">linesegments</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/mesh">mesh</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/meshscatter">meshscatter</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/pie">pie</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/poly">poly</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/qqplot">qqplot and qqnorm</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/rainclouds">rainclouds</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/rangebars">rangebars</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/scatter">scatter</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/scatterlines">scatterlines</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/series">series</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/spy">spy</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/stairs">stairs</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/stem">stem</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/stephist">stephist</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/streamplot">streamplot</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/surface">surface</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/text">text</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/tooltip">tooltip</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/tricontourf">tricontourf</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/triplot">triplot</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/violin">violin</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/volume">volume</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/volumeslices">volumeslices</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/voronoiplot">voronoiplot</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/waterfall">waterfall</a></div></li><li><div class="tocitem-container"><a href="../../../reference/plots/wireframe">wireframe</a></div></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-3"><i class="docs-chevron"></i></label><a href="../../../tutorials">Tutorials</a></div><ul><li><div class="tocitem-container"><a href="../../../tutorials/aspect-tutorial">Aspect ratio and size control tutorial</a></div></li><li><div class="tocitem-container"><a href="../../../tutorials/basic-tutorial">Basic Tutorial</a></div></li><li><div class="tocitem-container"><a href="../../../tutorials/layout-tutorial">Layout Tutorial</a></div></li><li><div class="tocitem-container"><a href="../../../tutorials/scenes">Scene tutorial</a></div></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-4"><i class="docs-chevron"></i></label><a href="../../../how-to">How-Tos</a></div><ul><li><div class="tocitem-container"><a href="../../../how-to/save-figure-with-transparency">How to save a <code>Figure</code> with transparency</a></div></li></ul></li><li><input checked="" class="collapse-toggle" id="menuitem-5" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-5"><i class="docs-chevron"></i></label><a href="../..">Explanations</a></div><ul><li><div class="tocitem-container"><a href="../../animation">Animations</a></div></li><li><input checked="" class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-5-2"><i class="docs-chevron"></i></label><a href="..">Backends</a></div><ul><li><div class="tocitem-container"><a href="../cairomakie">CairoMakie</a></div></li><li><div class="tocitem-container"><a href="../glmakie">GLMakie</a></div></li><li><div class="tocitem-container"><a class="active" href="">RPRMakie</a></div></li><li><div class="tocitem-container"><a href="../wglmakie">WGLMakie</a></div></li></ul></li><li><div class="tocitem-container"><a href="../../blocks">Blocks</a></div></li><li><div class="tocitem-container"><a href="../../cameras">Cameras</a></div></li><li><div class="tocitem-container"><a href="../../colors">Colors</a></div></li><li><div class="tocitem-container"><a href="../../events">Events</a></div></li><li><div class="tocitem-container"><a href="../../faq">Frequently Asked Questions</a></div></li><li><div class="tocitem-container"><a href="../../figure">Figures</a></div></li><li><div class="tocitem-container"><a href="../../figure_size">Exporting a Figure with physical dimensions</a></div></li><li><div class="tocitem-container"><a href="../../fonts">Fonts</a></div></li><li><div class="tocitem-container"><a href="../../headless">Headless</a></div></li><li><div class="tocitem-container"><a href="../../inspector">Inspecting Data</a></div></li><li><div class="tocitem-container"><a href="../../latex">LaTeX</a></div></li><li><div class="tocitem-container"><a href="../../layouting">How layouts work</a></div></li><li><div class="tocitem-container"><a href="../../lighting">Lighting</a></div></li><li><div class="tocitem-container"><a href="../../nodes">Observables &amp; Interaction</a></div></li><li><div class="tocitem-container"><a href="../../plot_method_signatures">Plot Method Signatures</a></div></li><li><div class="tocitem-container"><a href="../../recipes">Plot Recipes</a></div></li><li><div class="tocitem-container"><a href="../../scenes">Scenes</a></div></li><li><input class="collapse-toggle" id="menuitem-5-20" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-5-20"><i class="docs-chevron"></i></label><a href="../../theming">Theming</a></div><ul><li><div class="tocitem-container"><a href="../../theming/predefined_themes">Predefined themes</a></div></li></ul></li><li><div class="tocitem-container"><a href="../../transparency">Basic transparency</a></div></li></ul></li><li><div class="tocitem-container"><a href="../../../api">API</a></div></li><li><div class="tocitem-container"><a href="../../../news">News</a></div></li></ul></div></div><div class="franklin-content"><h1 id="rprmakie"><a class="header-anchor" href="#rprmakie">RPRMakie</a></h1><p>Experimental ray tracing backend using AMDs <a href="https://radeon-pro.github.io/RadeonProRenderDocs/en/index.html">RadeonProRender</a>. While it's created by AMD and tailored to Radeon GPUs, it still works just as well for NVidia and Intel GPUs using OpenCL. It also works on the CPU and even has a hybrid modus to use GPUs and CPUs in tandem to render images.</p><p>RadeonProRender currently only works on Windows and Linux, and crashes on OSX when creating the most basic context. If you're on OSX and good at debugging segfaults, help us by debugging:</p><pre><code class="language-julia">using RadeonProRender
RadeonProRender.Context()</code></pre><p>To use RPRMakie on a Mac with an M-series chip, for now, you need to use the x84 build of Julia (not the ARM build, you may have to download this manually).  RadeonProRender does not distribute binaries built for the ARM architecture of the M-series processors yet.</p><h2 id="activation_and_screen_config"><a class="header-anchor" href="#activation_and_screen_config">Activation and screen config</a></h2><p>Activate the backend by calling <code>RPRMakie.activate!()</code> with the following options:</p><pre><code>RPRMakie.activate!(; screen_config...)</code></pre><p>Sets RPRMakie as the currently active backend and also allows to quickly set the <code>screen_config</code>. Note, that the <code>screen_config</code> can also be set permanently via <code>Makie.set_theme!(RPRMakie=(screen_config...,))</code>.</p><h1>Arguments one can pass via <code>screen_config</code>:</h1><ul><li><p><code>iterations = 200</code>: Iterations of light simulations. The more iterations, the less noisy the picture becomes, but higher numbers take much longer. For e.g. <code>iterations=10</code> one should expect rendering to take a couple of seconds but it will produce pretty noisy output. 200 is a good middle ground taking around ~30s on an old nvidia 1060. For highest quality output, numbers above 500 are required.</p></li><li><p><code>resource = RPR.RPR_CREATION_FLAGS_ENABLE_GPU0</code>: GPU or CPU to use. Multiple GPUs and CPUs can be used together by using <code>&amp;</code> (e.g. <code>RPR.RPR_CREATION_FLAGS_ENABLE_GPU0 &amp; RPR.RPR_CREATION_FLAGS_ENABLE_CPU</code>).</p></li><li><p><code>plugin = RPR.Tahoe</code>:</p><ul><li><p><code>RPR.Tahoe</code>, the legacy RadeonProRender backend. It's the most stable, but doesn't have all new features (e.g. the <code>RPR.MatX</code> material), and may be slower than others</p></li><li><p><code>RPR.Northstar</code>, the new rewritten backend, faster and optimized for many iterations. Single iterations are much slower, so less usable for interactive display. Sometimes, Northstar just produces black, jiggly objects. It's not clear yet, if that's just a bug, or the result of using an unsupported/deprecated feature. Switch to <code>Tahoe</code> if that happens.</p></li><li><p><code>RPR.Hybrid</code>: Vulkan backend, fit for real time rendering, using AMDs and NVIDIAs new hardware accelerated ray tracing. Doesn't work reliably yet and only works with <code>RPR.Uber</code> material.</p></li><li><p><code>RPR.HybridPro</code>: The same as Hybrid, but works only for Radeon GPUs, using AMDs own hardware acceleration API.</p></li></ul></li></ul><p>Since RPRMakie is quite the unique backend and still experimental, there are several gotchas when working with it.</p><pre><code class="language-julia">fig = Figure(); # RPRMakie can't show Figures yet, since it only supports a physical 3D camera
radiance = 10000
# Lights are much more important for ray tracing,
# so most examples will use extra lights and environment lights.
# Note, that RPRMakie is the only backend
# supporting multiple light sources and EnvironmentLights right now
lights = [
    EnvironmentLight(0.5, Makie.FileIO.load(RPR.assetpath("studio026.exr"))),
    PointLight(Vec3f(0, 0, 20), RGBf(radiance, radiance, radiance))
]

# Only LScene is supported right now,
# since the other projections don't map to the pysical acurate Camera in RPR.
ax = LScene(fig[1, 1]; show_axis = false, scenekw=(lights=lights,))
# Note that since RPRMakie doesn't yet support text (this is being worked on!),
# you can't show a 3d axis yet.

# to create materials, one needs access to the RPR context.
# Note, if you create an Screen manually, don't display the scene or fig anymore, since that would create a new RPR context, in which resources from the manually created Context would be invalid. Since RPRs error handling is pretty bad, this usually results in Segfaults.
# See below how to render a picture with a manually created context
screen = RPRMakie.Screen(ax.scene; iterations=10, plugin=RPR.Northstar)
matsys = screen.matsys
context = screen.context
# You can use lots of materials from RPR.
# Note, that this API may change in the future to a backend  independent representation
# Or at least one, that doesn't need to access the RPR context
mat = RPR.Chrome(matsys)
# The material attribute is specific to RPRMakie and gets ignored by other Backends. This may change in the future
mesh!(ax, Sphere(Point3f(0), 1), material=mat)

# There are three main ways to turn a Makie scene into a picture:
# Get the colorbuffer of the Screen. Screen also has `show` overloaded for the mime `image\png` so it should display in IJulia/Jupyter/VSCode.
image = colorbuffer(screen)::Matrix{RGB{N0f8}}
# Replace a specific (sub) LScene with RPR, and display the whole scene interactively in RPRMakie
using RPRMakie
refres = Observable(nothing) # Optional observable that triggers
RPRMakie.activate!(); display(fig) # Make sure to display scene first in RPRMakie
# Replace the scene with an interactively rendered RPR output.
# See more about this in the RPRMakie interop example
context, task = RPRMakie.replace_scene_rpr!(ax.scene, screen; refresh=refresh)
# If one doesn't create the Screen manually to create custom materials,
# display(ax.scene), show(io, MIME"image/png", ax.scene), save("rpr.png", ax.scene)
# Should work just like with other backends.
# Note, that only the scene from LScene can be displayed directly, but soon, `display(fig)` should also work.</code></pre><p>There are several examples showing different aspects of how to use RPRMakie. The examples are in <a href="https://github.com/MakieOrg/Makie.jl/tree/master/RPRMakie/examples">RPRMakie/examples</a></p><h2 id="materialx_and_predefined_materials_materialsjl"><a class="header-anchor" href="#materialx_and_predefined_materials_materialsjl">MaterialX and predefined materials (materials.jl)</a></h2><p>There are several predefined materials one can use in RadeonProRender. RPR also supports the <a href="https://www.materialx.org/">MaterialX</a> standard to load a wide range of predefined Materials. Make sure to use the Northstar backend for <code>MaterialX</code>.</p><input class="hidecode" id="hidecode5" type="checkbox"/><pre><code class="language-julia">using GeometryBasics, RPRMakie
using Colors, FileIO
using Colors: N0f8

radiance = 500
lights = [EnvironmentLight(1.0, load(RPR.assetpath("studio026.exr"))),
            PointLight(Vec3f(10), RGBf(radiance, radiance, radiance * 1.1))]
fig = Figure(; resolution=(1500, 700));
ax = LScene(fig[1, 1]; show_axis=false, scenekw=(; lights=lights))
screen = RPRMakie.Screen(ax.scene; plugin=RPR.Northstar, iterations=400)

matsys = screen.matsys
emissive = RPR.EmissiveMaterial(matsys)
diffuse = RPR.DiffuseMaterial(matsys)
glass = RPR.Glass(matsys)
plastic = RPR.Plastic(matsys)
chrome = RPR.Chrome(matsys)
dielectric = RPR.DielectricBrdfX(matsys)
gold = RPR.SurfaceGoldX(matsys)

materials = [glass chrome;
                gold dielectric;
                emissive plastic]

mesh!(ax, load(Makie.assetpath("matball_floor.obj")); color=:white)
palette = reshape(Makie.default_palettes.color[][1:6], size(materials))

for i in CartesianIndices(materials)
    x, y = Tuple(i)
    mat = materials[i]
    mplot = if mat === emissive
        matball!(ax, diffuse; inner=emissive, color=nothing)
    else
        matball!(ax, mat; color=nothing)
    end
    v = Vec3f(((x, y) .- (0.5 .* size(materials)) .- 0.5)..., 0)
    translate!(mplot, 0.9 .* (v .- Vec3f(0, 3, 0)))
end
cam = cameracontrols(ax.scene)
cam.eyeposition[] = Vec3f(-0.3, -5.5, 0.9)
cam.lookat[] = Vec3f(0.5, 0, -0.5)
cam.upvector[] = Vec3f(0, 0, 1)
cam.fov[] = 35
emissive.color = Vec3f(4, 2, 2)
image = colorbuffer(screen)
save("materials.png", image)</code></pre><label class="hidecode" for="hidecode5"></label><img src="../../../assets/materials.png"/><h2 id="advanced_custom_material_earth_topographyjl"><a class="header-anchor" href="#advanced_custom_material_earth_topographyjl">Advanced custom material (earth_topography.jl)</a></h2><input class="hidecode" id="hidecode4" type="checkbox"/><pre><code class="language-julia">using NCDatasets, ColorSchemes, RPRMakie
using ImageShow, FileIO

# Taken from https://lazarusa.github.io/BeautifulMakie/GeoPlots/topography/
cmap = dataset = Dataset(joinpath(@__DIR__, "ETOPO1_halfdegree.nc"))
lon = dataset["lon"][:]
lat = dataset["lat"][:]
data = Float32.(dataset["ETOPO1avg"][:, :])

function glow_material(data_normed)
    emission_weight = map(data_normed) do i
        return Float32(i &lt; 0.7 ? 0.0 : i)
    end
    emission_color = map(data_normed) do i
        em = i * 2
        return RGBf(em * 2.0, em * 0.4, em * 0.3)
    end

    return (
        reflection_weight = 1,
        reflection_color = RGBf(0.5, 0.5, 1.0),
        reflection_metalness = 0,
        reflection_ior = 1.4,
        diffuse_weight = 1,
        emission_weight = emission_weight',
        emission_color = emission_color',
    )
end

RPRMakie.activate!(iterations=32, plugin=RPR.Northstar)
fig = Figure(; resolution=(2000, 800))
radiance = 30000
lights = [EnvironmentLight(1.0, load(RPR.assetpath("studio026.exr"))),
            PointLight(Vec3f(0, 100, 100), RGBf(radiance, radiance, radiance))]

ax = LScene(fig[1, 1]; show_axis=false, scenekw=(lights=lights,))

mini, maxi = extrema(data)
data_normed = ((data .- mini) ./ (maxi - mini))

material = glow_material(data_normed)

pltobj = surface!(ax, lon, lat, data_normed .* 20;
                    material=material, colormap=[:black, :white, :brown],
                    colorrange=(0.2, 0.8) .* 20)
# Set the camera to a nice angle
cam = cameracontrols(ax.scene)
cam.eyeposition[] = Vec3f(3, -300, 300)
cam.lookat[] = Vec3f(0)
cam.upvector[] = Vec3f(0, 0, 1)
cam.fov[] = 23

save("topographie.png", ax.scene)</code></pre><label class="hidecode" for="hidecode4"></label><img src="../../../assets/topographie.png"/><h2 id="rprmakie_interop_opengl_interopjl"><a class="header-anchor" href="#rprmakie_interop_opengl_interopjl">RPRMakie interop (opengl_interop.jl)</a></h2><p>RPRMakie doesn't support layouting and sub scenes yet, but you can replace a single scene with a RPR rendered, interactive window. This is especially handy, to show 2d graphics and interactive UI elements next to a ray traced scene and interactively tune camera and material parameters.</p><input class="hidecode" id="hidecode3" type="checkbox"/><pre><code class="language-julia">using RPRMakie, GeometryBasics, RPRMakie, RadeonProRender
using Colors, FileIO
using Colors: N0f8

f = (u, v) -&gt; cos(v) * (6 - (5 / 4 + sin(3 * u)) * sin(u - 3 * v))
g = (u, v) -&gt; sin(v) * (6 - (5 / 4 + sin(3 * u)) * sin(u - 3 * v))
h = (u, v) -&gt; -cos(u - 3 * v) * (5 / 4 + sin(3 * u));
u = range(0; stop=2Ï, length=150)
v = range(0; stop=2Ï, length=150)
radiance = 500
lights = [EnvironmentLight(1.0, load(RPR.assetpath("studio026.exr"))),
          PointLight(Vec3f(10), RGBf(radiance, radiance, radiance * 1.1))]

fig = Figure(; resolution=(1500, 1000))
ax = LScene(fig[1, 1]; show_axis=false, scenekw=(; lights=lights))
screen = RPRMakie.Screen(size(ax.scene); plugin=RPR.Tahoe)
material = RPR.UberMaterial(screen.matsys)

surface!(ax, f.(u, v'), g.(u, v'), h.(u, v'); ambient=Vec3f(0.5), diffuse=Vec3f(1), specular=0.5,
         colormap=:balance, material=material)

function Input(fig, val::RGB)
    hue = Slider(fig; range=1:380, width=200)
    lightness = Slider(fig; range=LinRange(0, 1, 100), width=200)
    labels = [Label(fig, "hue"; halign=:left), Label(fig, "light"; halign=:left)]
    layout = grid!(hcat(labels, [hue, lightness]))
    hsl = HSL(val)
    set_close_to!(hue, hsl.h)
    set_close_to!(lightness, hsl.l)
    color = map((h, l) -&gt; RGB(HSL(h, 0.9, l)), hue.value, lightness.value)
    return color, layout
end

function Input(fig, val::Vec4)
    s = Slider(fig; range=LinRange(0, 1, 100), width=200)
    set_close_to!(s, first(val))
    return map(x -&gt; Vec4f(x), s.value), s
end

function Input(fig, val::Bool)
    toggle = Toggle(fig; active=val)
    return toggle.active, toggle
end

sliders = (reflection_color=Input(fig, RGB(0, 0, 0)), reflection_weight=Input(fig, Vec4(0)),
           reflection_roughness=Input(fig, Vec4(0)), reflection_anisotropy=Input(fig, Vec4(0)),
           reflection_anisotropy_rotation=Input(fig, Vec4(0)), reflection_mode=Input(fig, Vec4(0)),
           reflection_ior=Input(fig, Vec4(0)), reflection_metalness=Input(fig, Vec4(0)),
           refraction_color=Input(fig, RGB(0, 0, 0)), refraction_weight=Input(fig, Vec4(0)),
           refraction_roughness=Input(fig, Vec4(0)), refraction_ior=Input(fig, Vec4(0)),
           refraction_absorption_color=Input(fig, RGB(0, 0, 0)),
           refraction_absorption_distance=Input(fig, Vec4(0)), refraction_caustics=Input(fig, true),
           sss_scatter_color=Input(fig, RGB(0, 0, 0)), sss_scatter_distance=Input(fig, Vec4(0)),
           sss_scatter_direction=Input(fig, Vec4(0)), sss_weight=Input(fig, Vec4(0)),
           sss_multiscatter=Input(fig, false), backscatter_weight=Input(fig, Vec4(0)),
           backscatter_color=Input(fig, RGB(0, 0, 0)))

labels = []
inputs = []
refresh = Observable(nothing)
for (key, (obs, input)) in pairs(sliders)
    push!(labels, Label(fig, string(key); align=:left))
    push!(inputs, input)
    on(obs) do value
        setproperty!(material, key, value)
        return notify(refresh)
    end
end

fig[1, 2] = grid!(hcat(labels, inputs); width=500)
RPRMakie.activate!()

cam = cameracontrols(ax.scene)
cam.eyeposition[] = Vec3f(22, 0, 17)
cam.lookat[] = Vec3f(0, 0, -1)
cam.upvector[] = Vec3f(0, 0, 1)
cam.fov[] = 30

display(fig)

context, task = RPRMakie.replace_scene_rpr!(ax.scene, screen; refresh=refresh)

# Change light parameters interactively
begin
    lights[1].intensity[] = 1.5
    lights[2].radiance[] = RGBf(1000, 1000, 1000)
    lights[2].position[] = Vec3f(3, 10, 10)
    notify(refresh)
end</code></pre><label class="hidecode" for="hidecode3"></label><video autoplay="" controls="" mute="" src="../../../assets/opengl_interop.mp4"></video><h2 id="animations_legojl"><a class="header-anchor" href="#animations_legojl">Animations (lego.jl)</a></h2><p>Not all objects support updating via Observables yet, but translations, camera etc are already covered and can be used together with Makie's standard animation API.</p><input class="hidecode" id="hidecode2" type="checkbox"/><pre><code class="language-julia"># Example inspiration and Lego model by https://github.com/Kevin-Mattheus-Moerman
# https://twitter.com/KMMoerman/status/1417759722963415041
using MeshIO, FileIO, GeometryBasics, RPRMakie

colors = Dict(
    "eyes" =&gt; "#000",
    "belt" =&gt; "#000059",
    "arm" =&gt; "#009925",
    "leg" =&gt; "#3369E8",
    "torso" =&gt; "#D50F25",
    "head" =&gt; "yellow",
    "hand" =&gt; "yellow"
)

origins = Dict(
    "arm_right" =&gt; Point3f(0.1427, -6.2127, 5.7342),
    "arm_left" =&gt; Point3f(0.1427, 6.2127, 5.7342),
    "leg_right" =&gt; Point3f(0, -1, -8.2),
    "leg_left" =&gt; Point3f(0, 1, -8.2),
)

rotation_axes = Dict(
    "arm_right" =&gt; Vec3f(0.0000, -0.9828, 0.1848),
    "arm_left" =&gt; Vec3f(0.0000, 0.9828, 0.1848),
    "leg_right" =&gt; Vec3f(0, -1, 0),
    "leg_left" =&gt; Vec3f(0, 1, 0),
)

function plot_part!(scene, parent, name::String)
    m = load(assetpath("lego_figure_" * name * ".stl"))
    color = colors[split(name, "_")[1]]
    trans = Transformation(parent)
    ptrans = Makie.transformation(parent)
    origin = get(origins, name, nothing)
    if !isnothing(origin)
        centered = m.position .- origin
        m = GeometryBasics.Mesh(meta(centered; normals=m.normals), faces(m))
        translate!(trans, origin)
    else
        translate!(trans, -ptrans.translation[])
    end
    return mesh!(scene, m; color=color, transformation=trans)
end

function plot_lego_figure(s, floor=true)
    # Plot hierarchical mesh!
    figure = Dict()
    # Plot hierarchical mesh!
    figure["torso"] = plot_part!(s, s, "torso")
        figure["head"] = plot_part!(s, figure["torso"], "head")
            figure["eyes_mouth"] = plot_part!(s, figure["head"], "eyes_mouth")
        figure["arm_right"] = plot_part!(s, figure["torso"], "arm_right")
            figure["hand_right"] = plot_part!(s, figure["arm_right"], "hand_right")
        figure["arm_left"] = plot_part!(s, figure["torso"], "arm_left")
            figure["hand_left"] = plot_part!(s, figure["arm_left"], "hand_left")
        figure["belt"] = plot_part!(s, figure["torso"], "belt")
            figure["leg_right"] = plot_part!(s, figure["belt"], "leg_right")
            figure["leg_left"] = plot_part!(s, figure["belt"], "leg_left")
    # lift the little guy up
    translate!(figure["torso"], 0, 0, 20)
    # add some floor
    floor &amp;&amp; mesh!(s, Rect3f(Vec3f(-400, -400, -2), Vec3f(800, 800, 2)), color=:white)
    return figure
end

RPRMakie.activate!(iterations=200, plugin=RPR.Northstar)
radiance = 50000
lights = [
    EnvironmentLight(1.5, rotl90(load(assetpath("sunflowers_1k.hdr"))')),
    PointLight(Vec3f(50, 0, 200), RGBf(radiance, radiance, radiance*1.1)),
]
s = Scene(resolution=(500, 500), lights=lights)

cam3d!(s)
c = cameracontrols(s)
c.near[] = 5
c.far[] = 1000
update_cam!(s, c, Vec3f(100, 30, 80), Vec3f(0, 0, -10))
figure = plot_lego_figure(s)

rot_joints_by = 0.25*pi
total_translation = 50
animation_strides = 10

a1 = LinRange(0, rot_joints_by, animation_strides)
angles = [a1; reverse(a1[1:end-1]); -a1[2:end]; reverse(-a1[1:end-1]);]
nsteps = length(angles); #Number of animation steps
translations = LinRange(0, total_translation, nsteps)

Makie.record(s, "lego_walk.mp4", zip(translations, angles)) do (translation, angle)

    # Rotate right arm + hand
    for name in ["arm_left", "arm_right", "leg_left", "leg_right"]
        rotate!(figure[name], rotation_axes[name], angle)
    end
    translate!(figure["torso"], translation, 0, 20)
end</code></pre><label class="hidecode" for="hidecode2"></label><video autoplay="" controls="" mute="" src="../../../assets/lego_walk.mp4"></video><h2 id="earth_example"><a class="header-anchor" href="#earth_example">Earth example</a></h2><input class="hidecode" id="hidecode1" type="checkbox"/><pre><code class="language-julia"># by Lazaro Alonso
# taken from: https://lazarusa.github.io/BeautifulMakie/GeoPlots/submarineCables3D/
using GeoMakie, Downloads
using GeoJSON, GeoInterface
using FileIO
using RPRMakie
# data from
# https://github.com/telegeography/www.submarinecablemap.com
urlPoints = "https://raw.githubusercontent.com/telegeography/www.submarinecablemap.com/master/web/public/api/v3/landing-point/landing-point-geo.json"
urlCables = "https://raw.githubusercontent.com/telegeography/www.submarinecablemap.com/master/web/public/api/v3/cable/cable-geo.json"

landPoints = Downloads.download(urlPoints, IOBuffer())
landCables = Downloads.download(urlCables, IOBuffer())

land_geoPoints = GeoJSON.read(seekstart(landPoints))
land_geoCables = GeoJSON.read(seekstart(landCables))

toPoints = GeoMakie.geo2basic(land_geoPoints)
feat = GeoInterface.features(land_geoCables)
toLines = GeoInterface.coordinates.(GeoInterface.geometry.(feat))

# broken lines at -180 and 180... they should
# be the same line and be in the same array.

# some 3D transformations
function toCartesian(lon, lat; r = 1.02, cxyz = (0, 0, 0))
    x = cxyz[1] + r * cosd(lat) * cosd(lon)
    y = cxyz[2] + r * cosd(lat) * sind(lon)
    z = cxyz[3] + r * sind(lat)
    return (x, y, z)
end

toPoints3D = [Point3f([toCartesian(point[1], point[2])...]) for point in toPoints]

splitLines3D = []
for i in 1:length(toLines)
    for j in 1:length(toLines[i])
        ptsLines = toLines[i][j]
        tmp3D = []
        for k in 1:length(ptsLines)
            x, y = ptsLines[k]
            x, y, z = toCartesian(x, y)
            push!(tmp3D, [x, y, z])
        end
        push!(splitLines3D, Point3f.(tmp3D))
    end
end

earth_img = load(Downloads.download("https://upload.wikimedia.org/wikipedia/commons/5/56/Blue_Marble_Next_Generation_%2B_topography_%2B_bathymetry.jpg"))
# the actual plot !
RPRMakie.activate!(; iterations=100)
scene = with_theme(theme_dark()) do
    fig = Figure(; resolution=(1000, 1000))
    radiance = 30
    lights = [EnvironmentLight(0.5, load(RPR.assetpath("starmap_4k.tif"))),
              PointLight(Vec3f(1, 1, 3), RGBf(radiance, radiance, radiance))]
    ax = LScene(fig[1, 1]; show_axis=false, scenekw=(;lights=lights))
    n = 1024 Ã· 4 # 2048
    Î¸ = LinRange(0, pi, n)
    Ï = LinRange(-pi, pi, 2 * n)
    xe = [cos(Ï) * sin(Î¸) for Î¸ in Î¸, Ï in Ï]
    ye = [sin(Ï) * sin(Î¸) for Î¸ in Î¸, Ï in Ï]
    ze = [cos(Î¸) for Î¸ in Î¸, Ï in Ï]
    surface!(ax, xe, ye, ze; color=earth_img)
    meshscatter!(toPoints3D; color=1:length(toPoints3D), markersize=0.005, colormap=:plasma)
    colors = Makie.default_palettes.color[]
    c = Iterators.cycle(colors)
    foreach(((l, c),) -&gt; lines!(ax, l; linewidth=2, color=c), zip(splitLines3D, c))
    ax.scene.camera_controls.eyeposition[] = Vec3f(1.5)
    return ax.scene
end

save("submarin_cables.png", scene)</code></pre><label class="hidecode" for="hidecode1"></label><img src="../../../assets/earth.png"/><div class="page-foot"><div class="copyright">
    Â© Makie.jl. Last modified: October 31, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
      <p>These docs were autogenerated using Makie: v0.19.12, GLMakie: v0.8.12, CairoMakie: v0.10.12, WGLMakie: v0.8.16</p></div></div></div></div><div class="page__footer"><footer><div class="page__footer-follow"><ul class="social-icons"><li><a href="https://twitter.com/MakiePlots" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-twitter-square"></i> Twitter</a></li><li><a href="https://github.com/JuliaPlots/Makie.jl" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-github"></i> GitHub</a></li></ul></div><div class="page__footer-copyright">Â© Makie.jl. Powered by <a href="https://github.com/tlienart/Franklin.jl">Franklin</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div></footer></div></div><script src="../../../../versions.js" type="text/javascript"></script><script src="../../../siteinfo.js" type="text/javascript"></script><script src="../../../libs/warner.js" type="text/javascript"></script><script src="../../../libs/navbar.js"></script><link href="../../../_pagefind/pagefind-ui.css" rel="stylesheet"/><script src="../../../_pagefind/pagefind-ui.js" type="text/javascript"></script><script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({
              element: "#makiesearch",
              showImages: false
            });
            new PagefindUI({
              element: "#makiesearch-overlay",
              showImages: false
            });
        });
    </script><script async="" defer="" src="https://api.makie.org/latest.js"></script><noscript><img alt="" referrerpolicy="no-referrer-when-downgrade" src="https://api.makie.org/noscript.gif"/></noscript><script src="../../../libs/highlight/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script></body></HTML>