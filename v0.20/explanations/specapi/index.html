<!DOCTYPE html><HTML lang="en"><head><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="../../libs/highlight/github.min.css" rel="stylesheet"/><link href="../../css/franklin.css" rel="stylesheet"/><link href="../../css/minimal-mistakes.css" rel="stylesheet"/><link href="../../css/makie.css" rel="stylesheet"/><link href="../../assets/icon_transparent.png" rel="icon"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://files.stork-search.net/releases/v1.4.2/basic.css" rel="stylesheet"/><style>
    .stork-wrapper {
      width:99%
    }
    .stork-wrapper .stork-results {
      max-height: 42vh;
    }
</style><title>SpecApi · Makie</title></head><body class="layout--single"><div class="site-container"><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav class="greedy-nav" id="site-nav"><a class="title-icon" href="../.."><img src="../../assets/makie_logo_transparent.svg"/></a><ul class="visible-links"><li class="masthead__menu-item"><a href="https://github.com/JuliaPlots/Makie.jl"><img class="masthead-icon" src="../../assets/GitHub-Mark-64px.png"/></a></li><li class="masthead__menu-item"><a href="../../reference/">Reference</a></li><li class="masthead__menu-item"><a href="../../tutorials/">Tutorials</a></li><li class="masthead__menu-item"><a href="../../how-to/">How-Tos</a></li><li class="masthead__menu-item"><a href="..">Explanations</a></li><li class="masthead__menu-item"><a href="../../api/">API</a></li><li class="masthead__menu-item"><a href="../../news/">News</a></li><li class="masthead__menu-item" id="masthead-search-button"><script>
                            function toggleSearchOverlay(){
                                const overlay = document.querySelector("#makiesearch-overlay-container");
                                overlay.classList.toggle("hidden");
                                overlay.querySelector("input").focus();
                                overlay.onclick = function(e){
                                    if (e.target !== this){
                                        return
                                    }
                                    this.classList.toggle("hidden");
                                };
                            }
                        </script><button onclick="toggleSearchOverlay()"><i class="fas fa-search"></i> Search</button></li></ul><button class="greedy-nav__toggle" type="button"><span class="visually-hidden">Toggle menu</span><div class="navicon"></div></button><ul class="hidden-links hidden"></ul></nav></div></div></div><div id="main" role="main"><div id="overlay"></div><div class="hidden" id="makiesearch-overlay-container"><div id="makiesearch-overlay-container-inner"><div id="makiesearch-overlay"></div></div></div><div class="content-table-hidden" id="content-table-container"><button id="on-this-page" onclick="toggle_content_table_visibility()">On this page</button><script>
            function toggle_content_table_visibility(){
              const c = document.querySelector("#content-table-container");
              const ct = c.querySelector("#content-table");
              const vh = window.visualViewport.height;
              ct.style.height = `${Math.min(ct.scrollHeight, 0.66*vh)}px`;
              c.classList.toggle("content-table-hidden");
            }
          </script><div id="content-table"><ul class="page-content"><li><a href="#what_is_the_specapi">What is the SpecApi?</a></li><li><a href="#building_layouts_for_specs">Building layouts for specs</a></li><li><a href="#advanced_spec_layouting">Advanced spec layouting</a></li><li><a href="#using_specs_in_convert_arguments">Using specs in <code>convert_arguments</code></a></li><li><a href="#convert_arguments_for_gridlayoutspec"><code>convert_arguments</code> for <code>GridLayoutSpec</code></a></li><li><a href="#convert_arguments_for_plotspecs"><code>convert_arguments</code> for <code>PlotSpec</code>s</a></li><li><a href="#interactive_example">Interactive example</a></li></ul></div></div><div id="navbar-container"><div id="navbar"><div id="makiesearch"></div><ul><li><div class="tocitem-container"><a href="../..">Home</a></div></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-2"><i class="docs-chevron"></i></label><a href="../../reference">Reference</a></div><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-2-1"><i class="docs-chevron"></i></label><a href="../../reference/blocks">Blocks</a></div><ul><li><div class="tocitem-container"><a href="../../reference/blocks/axis">Axis</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/axis3">Axis3</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/box">Box</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/button">Button</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/colorbar">Colorbar</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/gridlayout">GridLayout</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/intervalslider">IntervalSlider</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/label">Label</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/legend">Legend</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/lscene">LScene</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/menu">Menu</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/polaraxis">PolarAxis</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/slider">Slider</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/slidergrid">SliderGrid</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/textbox">Textbox</a></div></li><li><div class="tocitem-container"><a href="../../reference/blocks/toggle">Toggle</a></div></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-2-2"><i class="docs-chevron"></i></label><a href="../../reference/plots">Plots</a></div><ul><li><div class="tocitem-container"><a href="../../reference/plots/ablines">ablines</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/arc">arc</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/arrows">arrows</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/band">band</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/barplot">barplot</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/boxplot">boxplot</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/bracket">bracket</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/contour">contour</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/contour3d">contour3d</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/contourf">contourf</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/crossbar">crossbar</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/datashader">datashader</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/density">density</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/ecdf">ecdfplot</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/errorbars">errorbars</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/heatmap">heatmap</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/hexbin">hexbin</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/hist">hist</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/hvlines">hlines and vlines</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/hvspan">hspan and vspan</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/image">image</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/lines">lines</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/linesegments">linesegments</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/mesh">mesh</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/meshscatter">meshscatter</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/pie">pie</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/poly">poly</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/qqplot">qqplot and qqnorm</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/rainclouds">rainclouds</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/rangebars">rangebars</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/scatter">scatter</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/scatterlines">scatterlines</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/series">series</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/spy">spy</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/stairs">stairs</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/stem">stem</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/stephist">stephist</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/streamplot">streamplot</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/surface">surface</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/text">text</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/tooltip">tooltip</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/tricontourf">tricontourf</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/triplot">triplot</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/violin">violin</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/volume">volume</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/volumeslices">volumeslices</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/voronoiplot">voronoiplot</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/waterfall">waterfall</a></div></li><li><div class="tocitem-container"><a href="../../reference/plots/wireframe">wireframe</a></div></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-2-3"><i class="docs-chevron"></i></label><a href="../../reference/scene">Scene</a></div><ul><li><div class="tocitem-container"><a href="../../reference/scene/SSAO">SSAO</a></div></li><li><div class="tocitem-container"><a href="../../reference/scene/lighting">Lighting</a></div></li><li><div class="tocitem-container"><a href="../../reference/scene/matcap">Matcap</a></div></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-3"><i class="docs-chevron"></i></label><a href="../../tutorials">Tutorials</a></div><ul><li><div class="tocitem-container"><a href="../../tutorials/aspect-tutorial">Aspect ratio and size control tutorial</a></div></li><li><div class="tocitem-container"><a href="../../tutorials/basic-tutorial">Basic Tutorial</a></div></li><li><div class="tocitem-container"><a href="../../tutorials/layout-tutorial">Layout Tutorial</a></div></li><li><div class="tocitem-container"><a href="../../tutorials/scenes">Scene tutorial</a></div></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-4"><i class="docs-chevron"></i></label><a href="../../how-to">How-Tos</a></div><ul><li><div class="tocitem-container"><a href="../../how-to/draw-boxes-around-subfigures">How to draw boxes around subfigures</a></div></li><li><div class="tocitem-container"><a href="../../how-to/save-figure-with-transparency">How to save a <code>Figure</code> with transparency</a></div></li></ul></li><li><input checked="" class="collapse-toggle" id="menuitem-5" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-5"><i class="docs-chevron"></i></label><a href="..">Explanations</a></div><ul><li><div class="tocitem-container"><a href="../animation">Animations</a></div></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-5-2"><i class="docs-chevron"></i></label><a href="../backends">Backends</a></div><ul><li><div class="tocitem-container"><a href="../backends/cairomakie">CairoMakie</a></div></li><li><div class="tocitem-container"><a href="../backends/glmakie">GLMakie</a></div></li><li><div class="tocitem-container"><a href="../backends/rprmakie">RPRMakie</a></div></li><li><div class="tocitem-container"><a href="../backends/wglmakie">WGLMakie</a></div></li></ul></li><li><div class="tocitem-container"><a href="../blocks">Blocks</a></div></li><li><div class="tocitem-container"><a href="../cameras">Cameras</a></div></li><li><div class="tocitem-container"><a href="../colors">Colors</a></div></li><li><div class="tocitem-container"><a href="../events">Events</a></div></li><li><div class="tocitem-container"><a href="../faq">Frequently Asked Questions</a></div></li><li><div class="tocitem-container"><a href="../figure">Figures</a></div></li><li><div class="tocitem-container"><a href="../fonts">Fonts</a></div></li><li><div class="tocitem-container"><a href="../headless">Headless</a></div></li><li><div class="tocitem-container"><a href="../inspector">Inspecting Data</a></div></li><li><div class="tocitem-container"><a href="../latex">LaTeX</a></div></li><li><div class="tocitem-container"><a href="../layouting">How layouts work</a></div></li><li><div class="tocitem-container"><a href="../nodes">Observables &amp; Interaction</a></div></li><li><div class="tocitem-container"><a href="../plot_method_signatures">Plot Method Signatures</a></div></li><li><div class="tocitem-container"><a href="../recipes">Plot Recipes</a></div></li><li><div class="tocitem-container"><a href="../scenes">Scenes</a></div></li><li><div class="tocitem-container"><a class="active" href="">SpecApi</a></div></li><li><input class="collapse-toggle" id="menuitem-5-19" type="checkbox"/><div class="tocitem-container"><label class="tocexpander" for="menuitem-5-19"><i class="docs-chevron"></i></label><a href="../theming">Theming</a></div><ul><li><div class="tocitem-container"><a href="../theming/predefined_themes">Predefined themes</a></div></li></ul></li><li><div class="tocitem-container"><a href="../transparency">Basic transparency</a></div></li></ul></li><li><div class="tocitem-container"><a href="../../api">API</a></div></li><li><div class="tocitem-container"><a href="../../news">Changelog</a></div></li></ul></div></div><div class="franklin-content"><h1 id="specapi"><a class="header-anchor" href="#specapi">SpecApi</a></h1><div class="admonition warning"><p class="admonition-title">Warning</p><p>The SpecApi is still under active development and might introduce breaking changes quickly in the future. It's also slower for animations than using the normal Makie API, since it needs to re-create plots often and needs to go over the whole plot tree to find different values. While the performance will always be slower than directly using Observables to update attributes, it's still not much optimized so we expect to improve it in the future. You should also expect bugs, since the API is still very new while offering lots of new and complex functionality. Don't hesitate to open issues if you run into unexpected behaviour. PRs are also more than welcome, the code isn't actually that complex and should be easy to dive into (src/basic_recipes/specapi.jl).</p></div><h2 id="what_is_the_specapi"><a class="header-anchor" href="#what_is_the_specapi">What is the SpecApi?</a></h2><p>Starting with version 0.20, Makie supports the creation of plots and figures through specification or "spec" objects. These objects are declarative versions of familiar objects like <code>Axis</code>, <code>Colorbar</code>, <code>Scatter</code> or <code>Heatmap</code>. Declarative means that these objects do not implement any of the complex internal machinery needed for interactive, stateful plotting. Instead, they are simply descriptions which Makie then converts into the full objects for you.</p><p>Why is this useful?</p><p>Spec objects are lightweight and easy to compose into larger structures without having to build those up step by step. This makes it possible to glue together subfigures returned from different functions, instead of having these functions mutatingly plot into the same existing parent <code>Figure</code>. You can also plot observable spec objects into a given <code>Figure</code> and when you change the description, the whole subfigure updates or rebuilds itself automatically, trying to preserve existing structures where possible through the use of diffing. This can make building dashboards or smaller interactive apps much easier because the user has to keep track of less state. On the flip side, diffing introduces a performance overhead and will in general not be as fast as using Makie's mutating API directly.</p><p>You can create spec objects with the <code>Makie.SpecApi</code> object. There are mainly two types of specs, <code>PlotSpec</code>s and <code>BlockSpec</code>s, corresponding to plot objects like <code>Scatter</code> or <code>Heatmap</code>, and <code>Block</code> objects like <code>Axis</code> or <code>Colorbar</code>.</p><p>The API is supposed to be similar to the normal API, just declarative. Complex specs are built by nesting simpler specs inside each other. The convention is to always use the <code>S</code> prefix when creating spec objects, so they can't be confused with their counterparts from the standard API.</p><pre><code class="language-julia">import Makie.SpecApi as S

scatterspec = S.Scatter(1:4) # a PlotSpec describing a Scatter plot
axspec = S.Axis(plots=[scatterspec]) # a BlockSpec describing an Axis with a Scatter plot
layout_spec = S.GridLayout(axspec) # a Layout describing a Figure with an Axis with a Scatter plot

# Now we can instantiate the spec into a fully realized Figure.
# Note that the output type from `plot` is currently, a bit confusingly, a
# FigureAxisPlot type, which does not really fit because `pl` is not a normal plot
# and there can be zero or many axes in the figure.
# This will be changed in future iterations.
f, _, pl = plot(layout_spec)

# By updating the input observable of `pl`, our "plot" object, we can
# update all the content in the Figure with something new. In this case,
# we just change the plot type in the Axis from Scatter to Lines, and the
# axis title to "Lines".
pl[1] = S.GridLayout(S.Axis(; title="Lines", plots=[S.Lines(1:4)]))</code></pre><p>You can not only <code>plot</code> specs describing whole layout, but also specs describing <code>Block</code>s or just single plots.</p><pre><code class="language-julia">s = Makie.PlotSpec(:Scatter, 1:4; color=:red)
axis = Makie.BlockSpec(:Axis; title="Axis at layout position (1, 1)")</code></pre><h2 id="building_layouts_for_specs"><a class="header-anchor" href="#building_layouts_for_specs">Building layouts for specs</a></h2><p>To build layouts quickly, you can pass column vectors, row vectors or matrices of block specs to <code>S.GridLayout</code>. If you need more control over the layout, you can specify row and column sizes and gaps directly.</p><pre><code class="language-julia">using GLMakie
using DelimitedFiles
using Makie.FileIO
import Makie.SpecApi as S
using Random

Random.seed!(123)

volcano = readdlm(Makie.assetpath("volcano.csv"), ',', Float64)
brain = load(assetpath("brain.stl"))
r = LinRange(-1, 1, 100)
cube = [(x .^ 2 + y .^ 2 + z .^ 2) for x = r, y = r, z = r]

density_plots = map(x -&gt; S.Density(x * randn(200) .+ 3x, color=:y), 1:5)
brain_mesh = S.Mesh(brain, colormap=:Spectral, color=[tri[1][2] for tri in brain for i in 1:3])
volcano_contour = S.Contourf(volcano; colormap=:inferno)
cube_contour = S.Contour(cube, alpha=0.5)

ax_densities = S.Axis(; plots=density_plots, yautolimitmargin = (0, 0.1))
ax_volcano = S.Axis(; plots=[volcano_contour])
ax_brain = S.Axis3(; plots=[brain_mesh], protrusions = (50, 20, 10, 0))
ax_cube = S.Axis3(; plots=[cube_contour], protrusions = (50, 20, 10, 0))

spec_column_vector = S.GridLayout([ax_densities, ax_volcano, ax_brain]);
spec_matrix = S.GridLayout([ax_densities ax_volcano; ax_brain ax_cube]);
spec_row = S.GridLayout([spec_column_vector spec_matrix], colsizes = [Auto(), Auto(4)])

f, ax, pl = plot(S.GridLayout(spec_row); figure = (; fontsize = 10))</code></pre><p></p><p><a id="example_a690d506"><img height="450" src="../../assets/explanations/specapi/code/output/example_a690d506.png" width="600"/></a></p><h2 id="advanced_spec_layouting"><a class="header-anchor" href="#advanced_spec_layouting">Advanced spec layouting</a></h2><p>If you need even more control, you can pass the position of each object in your layout to <code>S.GridLayout</code> directly. These positions are specified as a tuple of <code>(rows, columns [, side])</code> where <code>side</code> is <code>Inside()</code> by default. For <code>rows</code> and <code>columns</code> you can either use integers like <code>2</code>, ranges like <code>1:3</code> or the colon operator <code>:</code> which spans across all rows or columns that are specified for other elements. Rows and columns start at <code>1</code> by default but you can also use numbers lower than <code>1</code> if necessary.</p><pre><code class="language-julia">using CairoMakie
import Makie.SpecApi as S

plot(
    S.GridLayout([
        (1, 1) =&gt; S.Axis(),
        (1, 2) =&gt; S.Axis(),
        (2, :) =&gt; S.Axis(),
        (2, 2, Right()) =&gt; S.Box(),
        (2, 2, Right()) =&gt; S.Label(
            text = "Label",
            rotation = pi/2,
            padding = (10, 10, 10, 10)
        ),
    ])
)</code></pre><p></p><p><a id="example_eaf7879b"><img height="450" src="../../assets/explanations/specapi/code/output/example_eaf7879b.svg" width="600"/></a></p><p>You can also use manual positions with nested <code>GridLayout</code>s.</p><pre><code class="language-julia">using CairoMakie
import Makie.SpecApi as S

plot(S.GridLayout([
    (1, 1) =&gt; S.Axis(),
    (1, 2) =&gt; S.Axis(),
    (2, :) =&gt; S.GridLayout(fill(S.Axis(), 1, 3)),
]))</code></pre><p></p><p><a id="example_fc99f0ce"><img height="450" src="../../assets/explanations/specapi/code/output/example_fc99f0ce.png" width="600"/></a></p><p>Here are all the keyword arguments that <code>S.GridLayout</code> accepts.</p><pre><code class="language-julia">S.GridLayout([...],
    colsizes = [Auto(), Auto(), 300],
    rowsizes = [Relative(0.4), Relative(0.6)],
    colgaps,
    rowgaps,
    alignmode,
    halign,
    valign,
    tellheight,
    tellwidth,
)</code></pre><h2 id="using_specs_in_convert_arguments"><a class="header-anchor" href="#using_specs_in_convert_arguments">Using specs in <code>convert_arguments</code></a></h2><div class="admonition warning"><p class="admonition-title">Warning</p><p>It's not decided yet how to forward keyword arguments from <code>plots(...; kw...)</code> to <code>convert_arguments</code> for the SpecApi in a more convenient and performant way. Until then, you need to mark attributes you want to use in <code>convert_arguments</code> with <code>Makie.used_attributes</code>, but this will completely redraw the entire spec on change of any attribute. We also may require users to overload a different function in future versions.</p></div><p>You can overload <code>convert_arguments</code> and return an array of <code>PlotSpecs</code> or a <code>GridLayoutSpec</code>. The main difference between those is, that returning an array of <code>PlotSpecs</code> may be plotted like any recipe into axes, while overloads returning <code>GridLayoutSpec</code> may not.</p><h2 id="convert_arguments_for_gridlayoutspec"><a class="header-anchor" href="#convert_arguments_for_gridlayoutspec"><code>convert_arguments</code> for <code>GridLayoutSpec</code></a></h2><p>In this example, we overload <code>convert_arguments</code> for a custom type to create facet grids easily.</p><pre><code class="language-julia">using CairoMakie
import Makie.SpecApi as S

# Our custom type we want to write a conversion method for
struct PlotGrid
    nplots::Tuple{Int,Int}
end

# If we want to use the `color` attribute in the conversion, we have to
# mark it via `used_attributes`
Makie.used_attributes(::PlotGrid) = (:color,)

# The conversion method creates a grid of `Axis` objects with `Lines` plot inside
# We restrict to Plot{plot}, so that only `plot(PlotGrid(...))` works, but not e.g. `scatter(PlotGrid(...))`.
function Makie.convert_arguments(::Type{Plot{plot}}, obj::PlotGrid; color=:black)
    axes = [
        S.Axis(plots=[S.Lines(cumsum(randn(1000)); color=color)])
            for i in 1:obj.nplots[1],
                j in 1:obj.nplots[2]
    ]
    return S.GridLayout(axes)
end

# Now, when we plot `PlotGrid` we get a whole facet layout
plot(PlotGrid((3, 4)))</code></pre><p></p><p><a id="example_91726b4e"><img height="450" src="../../assets/explanations/specapi/code/output/example_91726b4e.svg" width="600"/></a></p><p>We can also plot into existing <code>Figure</code>s with our new <code>plot</code> method:</p><pre><code class="language-julia">f = Figure()
plot(f[1, 1], PlotGrid((2, 2)); color=Cycled(1))
plot(f[1, 2], PlotGrid((3, 2)); color=Cycled(2))
f</code></pre><p></p><p><a id="example_ee06fb9b"><img height="450" src="../../assets/explanations/specapi/code/output/example_ee06fb9b.svg" width="600"/></a></p><h2 id="convert_arguments_for_plotspecs"><a class="header-anchor" href="#convert_arguments_for_plotspecs"><code>convert_arguments</code> for <code>PlotSpec</code>s</a></h2><p>We can return a vector of <code>PlotSpec</code>s from <code>convert_arguments</code> which allows us to dynamically choose the plot objects we want to add given the input data. While you could choose plot types based on input data with the old recipe API as well, this did not easily work for observable updates that changed these plot types in an existing figure. For this, users had to do tedious manual bookkeeping which is now abstracted away.</p><p>Note, that this method currently doesn't allow to forward keyword arguments from the <code>plot</code> command to <code>convert_arguments</code>, so we put the plot arguments into the <code>LineScatter</code> object in the following example:</p><pre><code class="language-julia">using CairoMakie
import Makie.SpecApi as S
using Random

Random.seed!(123)

# define a struct for `convert_arguments`
struct CustomMatrix
    data::Matrix{Float32}
    style::Symbol
    kw::Dict{Symbol,Any}
end
CustomMatrix(data; style, kw...) = CustomMatrix(data, style, Dict{Symbol,Any}(kw))

function Makie.convert_arguments(::Type{&lt;:AbstractPlot}, obj::CustomMatrix)
    plots = PlotSpec[]
    if obj.style === :heatmap
        push!(plots, S.Heatmap(obj.data; obj.kw...))
    elseif obj.style === :contourf
        push!(plots, S.Contourf(obj.data; obj.kw...))
    end
    max_position = Tuple(argmax(obj.data))
    push!(plots, S.Scatter(max_position; markersize = 30, strokecolor = :white, color = :transparent, strokewidth = 4))
    return plots
end

data = randn(30, 30)

f = Figure()
ax = Axis(f[1, 1])
# We can either plot into an existing Axis
plot!(ax, CustomMatrix(data, style = :heatmap, colormap = :Blues))
# Or create a new one automatically as we are used to from the standard API
plot(f[1, 2], CustomMatrix(data, style = :contourf, colormap = :inferno))
f</code></pre><p></p><p><a id="example_3222847a"><img height="450" src="../../assets/explanations/specapi/code/output/example_3222847a.png" width="600"/></a></p><h2 id="interactive_example"><a class="header-anchor" href="#interactive_example">Interactive example</a></h2><p>The SpecApi is geared towards dashboards and interactively creating complex plots. Here is an example using a <code>Slider</code> and a <code>Menu</code>, to visualize a fake simulation:</p><input class="hidecode" id="hidecode" type="checkbox"/><pre><code class="language-julia">using GLMakie
import Makie.SpecApi as S

struct MySimulation
    plottype::Symbol
    arguments::AbstractVector
end

function Makie.convert_arguments(::Type{&lt;:AbstractPlot}, sim::MySimulation)
    return map(enumerate(sim.arguments)) do (i, data)
        return PlotSpec(sim.plottype, data)
    end
end
f = Figure()
s = Slider(f[1, 1], range=1:10)
m = Menu(f[1, 2], options=[:Scatter, :Lines, :BarPlot])
sim = lift(s.value, m.selection) do n_plots, p
    Random.seed!(123)
    args = [cumsum(randn(100)) for i in 1:n_plots]
    return MySimulation(p, args)
end
ax, pl = plot(f[2, :], sim)
tight_ticklabel_spacing!(ax)
# lower priority to make sure the call back is always called last
on(sim; priority=-1) do x
    autolimits!(ax)
end

record(f, "interactive_specapi.mp4", framerate=1) do io
    pause = 0.1
    m.i_selected[] = 1
    for i in 1:4
        set_close_to!(s, i)
        sleep(pause)
        recordframe!(io)
    end
    m.i_selected[] = 2
    sleep(pause)
    recordframe!(io)
    for i in 5:7
        set_close_to!(s, i)
        sleep(pause)
        recordframe!(io)
    end
    m.i_selected[] = 3
    sleep(pause)
    recordframe!(io)
    for i in 7:10
        set_close_to!(s, i)
        sleep(pause)
        recordframe!(io)
    end
end</code></pre><label class="hidecode" for="hidecode"></label><video autoplay="" controls="" loop="" muted="" playsinline="" src="../../assets/explanations/specapi/code/output/interactive_specapi.mp4"></video><div class="page-foot"><div class="copyright">
    © Makie.jl. Last modified: May 07, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
      <p>These docs were autogenerated using Makie: v0.20.10, GLMakie: v0.9.11, CairoMakie: v0.11.12, WGLMakie: v0.9.10</p></div></div></div></div><div class="page__footer"><footer><div class="page__footer-follow"><ul class="social-icons"><li><a href="https://twitter.com/MakiePlots" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-twitter-square"></i> Twitter</a></li><li><a href="https://github.com/JuliaPlots/Makie.jl" rel="nofollow noopener noreferrer"><i aria-hidden="true" class="fab fa-fw fa-github"></i> GitHub</a></li></ul></div><div class="page__footer-copyright">© Makie.jl. Powered by <a href="https://github.com/tlienart/Franklin.jl">Franklin</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div></footer></div></div><script src="../../../versions.js" type="text/javascript"></script><script src="../../siteinfo.js" type="text/javascript"></script><script src="../../libs/warner.js" type="text/javascript"></script><script src="../../libs/navbar.js"></script><link href="../../pagefind/pagefind-ui.css" rel="stylesheet"/><script src="../../pagefind/pagefind-ui.js" type="text/javascript"></script><script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({
              element: "#makiesearch",
              showImages: false
            });
            new PagefindUI({
              element: "#makiesearch-overlay",
              showImages: false
            });
        });
    </script><script async="" defer="" src="https://api.makie.org/latest.js"></script><noscript><img alt="" referrerpolicy="no-referrer-when-downgrade" src="https://api.makie.org/noscript.gif"/></noscript><script src="../../libs/highlight/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script></body></HTML>